<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xiaojiuwo.models.mapper.AreasMapper">




    <select id="findStationAreaPoints" resultType="Station" parameterType="map">
      select
        p.id as id,
        s.id as stationId,
        s.description as stationName,

        a.id as areaId,
        a.lable as areaLabel,

        p.lantitude as lantitude,
        p.longitude as longitude,

      from stations s, area a, points p

      where s.id = ${stationId}
      and s.id = a.station_id
      and p.id = a.id
      and p.stationable_type = 'Area'

    </select>

    <select id="findSataionAreas" resultType="Area" parameterType="map">
        select

        a.id as id,
        a.label as label,
        a.code as code,
        c.price as price


        from  areas a
        left join commissions c on a.commission_id = c.id
        where a.station_id = ${stationId}




    </select>

    <select id="findAreaPoints" resultType="Point" parameterType="map">
        select

        p.id as id,
        p.lantitude as lantitude,
        p.longitude as longitude


        from points p
        where p.pointable_id = #{areaId}
        and p.pointable_type = 'Area'


    </select>

    <insert id="insert" parameterType="Area" keyProperty="id" useGeneratedKeys="true">
        insert into areas(
        station_id,
        label,
        created_at,
        updated_at,
        commission_id,
        code,
        latitude,
        longitude,
        distance,
        mian)

        values(
        #{stationId},
        #{label},
        #{createdAt},
        #{updatedAt},
        #{commissionId},
        #{code},
        #{latitude},
        #{longitude},
        #{distance},
        #{mian}

        )

    </insert>

    <update id="update">
        update areas
        <set>
            <if test="stationId != null">station_id=#{stationId},</if>
            <if test="label != null">label=#{label},</if>
            <if test="createdAt != null">created_at=#{createdAt},</if>
            <if test="updatedAt != null">updated_at=#{updatedAt}</if>
            <if test="commissionId != null">commission_id=#{commissionId}</if>
            <if test="code != null">code=#{code}</if>
            <if test="latitude != null">latitude=#{latitude}</if>
            <if test="longitude != null">longitude=#{longitude}</if>
            <if test="distance != null">distance=#{distance}</if>
            <if test="mian != null">mian=#{mian}</if>
        </set>
        where id=#{id}
    </update>

    <delete id="delete" parameterType="map">
        delete from areas where id = #{id}
    </delete>
</mapper>